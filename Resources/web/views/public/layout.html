<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <title langtag="title-admin"></title>

    <!-- Mainly scripts -->
    <!-- Latest compiled and minified CSS -->
    <link href="{{.WebBaseUrl}}/static/css/fontawesome.min.css" rel="stylesheet">
    <link href="{{.WebBaseUrl}}/static/css/solid.min.css" rel="stylesheet">
    <link href="{{.WebBaseUrl}}/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="{{.WebBaseUrl}}/static/css/bootstrap-table.min.css" rel="stylesheet">
    <link href="{{.WebBaseUrl}}/static/css/style.css" rel="stylesheet">

    <!-- Latest compiled and minified JavaScript -->
    <script src="{{.WebBaseUrl}}/static/js/jquery-3.4.1.min.js"></script>
    <script src="{{.WebBaseUrl}}/static/js/popper.min.js"></script>
    <script src="{{.WebBaseUrl}}/static/js/bootstrap.min.js"></script>
    <script src="{{.WebBaseUrl}}/static/js/bootstrap-table.min.js"></script>
    <script src="{{.WebBaseUrl}}/static/js/bootstrap-table-locale-all.min.js"></script>
    <script src="{{.WebBaseUrl}}/static/js/echarts.min.js"></script>
    <script src="{{.WebBaseUrl}}/static/js/inspinia.js"></script>
    <!-- Latest compiled and minified Locales -->
    <script src="{{.WebBaseUrl}}/static/js/language.js" type="text/javascript"></script>

</head>

<body class="pace-done fixed-nav fixed-nav-basic">
<div id="wrapper">
    <nav class="navbar-default navbar-static-side" role="navigation">
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">
                <li class="nav-header">
                    <div class="dropdown profile-element">
                    {{if eq true .IsAdmin}}
                        <span><i class="fa fa-user-cog fa-3x"></i></span>
                        <span class="clear"> <span class="block m-t-xs"><strong class="font-bold" langtag="word-admin"></strong></span>
                        <span class="text-muted text-xs block" langtag="word-system">
                    {{else}}
                        <span><i class="fa fa-user fa-3x"></i></span>
                        <span class="clear"> <span class="block m-t-xs"><strong class="font-bold">{{.Username}}</strong></span>
                        <span class="text-muted text-xs block" langtag="word-user">
                    {{end}}
                        </span>
                    </div>
                    <div class="logo-element" langtag="application"></div>
                </li>
                <li class="{{if eq "index" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/"><i class="fa fa-tachometer-alt fa-lg"></i>
                    <span class="nav-label" langtag="word-dashboard">当前</span></a>
                </li>
                <li class="{{if eq "chains" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/chains"><i class="fa fa-desktop fa-lg"></i>
                    <span class="nav-label" langtag="proxy-chains">选择线路</span></a>
                </li>
                <li class="{{if eq "host" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/z-rule"><i class="fa fa-globe fa-lg"></i>
                    <span class="nav-label" langtag="scheme-host">本地列表（不使用代理,只适用路由器）</span></a>
                </li>
                <li class="{{if eq "reverse-client" .Menu}}active{{end}}" >
                    <a href="#"><i class="fa fa-retweet fa-lg" id="start-route-tag" onclick="return SetRouter(false)" ></i>
                    <span class="nav-label" langtag="reverse-client" id="start-route-tag-tag"  >xxx路由器（只在路由器上使用）</span></a>
                </li>
                <!-- <li class="{{if eq "reverse-client" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/reverse-session"><i class="fa fa-retweet fa-lg"></i>
                    <span class="nav-label" langtag="reverse-client"></span></a>
                </li>
                <li class="{{if eq "graph" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/graph"><i class="fa fa-random fa-lg"></i>
                    <span class="nav-label" langtag="scheme-graph"></span></a>
                </li>
                <li class="{{if eq "File" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/file"><i class="fa fa-random fa-lg"></i>
                    <span class="nav-label" langtag="scheme-file">File</span></a>
                </li> -->
                <!-- <li class="{{if eq "http" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/http"><i class="fa fa-server fa-lg"></i>
                    <span class="nav-label" langtag="scheme-httpproxy"></span></a>
                </li>
                <li class="{{if eq "socks5" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/socks5"><i class="fa fa-layer-group fa-lg"></i>
                    <span class="nav-label" langtag="scheme-socks5"></span></a>
                </li>
                <li class="{{if eq "secret" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/secret"><i class="fa fa-low-vision fa-lg"></i>
                    <span class="nav-label" langtag="scheme-secret"></span></a>
                </li>
                <li class="{{if eq "p2p" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/p2p"><i class="fa fa-exchange-alt fa-lg"></i>
                    <span class="nav-label" langtag="scheme-p2p"></span></a>
                </li>
                <li class="{{if eq "file" .Menu}}active{{end}}">
                    <a href="{{.WebBaseUrl}}/index/file"><i class="fa fa-briefcase fa-lg"></i>
                    <span class="nav-label" langtag="scheme-file"></span></a>
                </li>
                <li class="{{if eq "help" .Menu}}active{{end}}">
                    <a href="https://ehang.io/nps/documents" target="_blank"><i class="fa fa-lightbulb fa-lg"></i>
                    <span class="nav-label" langtag="word-help"></span></a>
                </li> -->
            </ul>
        </div>
    </nav>
    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom">
            <nav class="navbar white-bg navbar-fixed-top" role="navigation" style="margin-bottom: 0">

                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i></a>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message"><span langtag="word-welcome"></span>
                        <a href="https://ehang.io/nps" langtag="application"></a></span>
                    </li>
                    <li>
                        <span class="btn-group dropdown">
                            <button id="languagemenu" class="btn btn-primary dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="fa fa-globe-asia fa-lg"></i><span></span></button>
                            <ul class="dropdown-menu"></ul>
                        </span>
                    </li>
                    <li>
                        <a href="{{.WebBaseUrl}}/login/out">
                            <i class="fa fa-sign-in-alt"></i><span langtag="word-logout"></span>
                        </a>
                    </li>
                </ul>
            </nav>
        </div>

    {{.LayoutContent}}

        <div class="footer fixed">
            <div class="float-right">
                <!-- <span langtag="word-readmore"></span> <strong><a href="https://ehang.io/nps" langtag="word-go"></a></strong> -->
            </div>
            <div><strong langtag="word-copyright"></strong> <span langtag="application"></span> &copy; 2018-2020</div>
        </div>
    </div>
</div>
<div class="modal fade" id="modal-area" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="modal-title">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body" id="modal-body">
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
</div>
</body>
</html>

<script>
    window.nps = { "WebBaseUrl": "{{.WebBaseUrl}}" }
    $("[langtag]").each((i,e)=>{
            let t = e.getAttribute("langtag");
            console.log(e,t);
            if (t != null){
                if (e.textContent == ""){
                    e.textContent = t.split("-")[1];
                }
            }
        });
/*     googleTranslateElementInit()
    
     function googleTranslateElementInit() {
         new google.translate.TranslateElement({
             layout: google.translate.TranslateElement.InlineLayout.HORIZONTAL
         }, 'wrapper');
     }
*/
function ModalSet(body){
    $("#modal-body").html(body);
    $("#modal-area").modal()
}


function CheckRoute_state(){
    fetch("/z-route",{
        method:"POST",
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({
            op:"check",
        })
    }).then((response) => {
        try{
            return response.json();
        }catch {
            return null;
        }
    }).then(d=>{
        if (d.msg.can){
            
            if (!d.msg.running){
                let r = document.querySelector("#start-route-tag-tag");
                r.textContent = "Start Router"
                r.setAttribute("onclick", 'return SetRouter(true)')
                document.querySelector("#start-route-tag").setAttribute("onclick", 'return SetRouter(true)')
            }else{
                let r = document.querySelector("#start-route-tag-tag");
                r.textContent = "Stop Router"
                r.setAttribute("onclick", 'return SetRouter(false)')
                document.querySelector("#start-route-tag").setAttribute("onclick", 'return SetRouter(false)')
            }
            
        }else{
            if (!d.msg.running){
                let r = document.querySelector("#start-route-tag-tag");
                r.textContent = "Start Global Mode"
                r.setAttribute("onclick", 'return SetRouter(true)')
                document.querySelector("#start-route-tag").setAttribute("onclick", 'return SetRouter(true)')
            }else{
                let r = document.querySelector("#start-route-tag-tag");
                r.textContent = "Stop Global Mode"
                r.setAttribute("onclick", 'return SetRouter(false)')
                document.querySelector("#start-route-tag").setAttribute("onclick", 'return SetRouter(false)')
            }
        }
    })
}

function SetRouter(st) {
    // document.querySelector("#router").style.display = "none"
    if (st){
        fetch("/z-route",{
            method:"POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                op:"start",
                state:st,
            })
        }).then((response) => {
            try{
                return response.json();
            }catch {
                return null;
            }
        }).then(d=>{
            
            if (d.status =="ok"){
                let r = document.querySelector("#start-route-tag-tag");
                r.textContent = "Stop"
                r.setAttribute("onclick", 'return SetRouter(false)')
                document.querySelector("#start-route-tag").setAttribute("onclick", 'return SetRouter(false)')
                
            }
        })   
    }else{
        fetch("/z-route",{
            method:"POST",
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({
                op:"stop",
                state:st,
            })
        }).then((response) => {
            try{
                return response.json();
            }catch {
                return null;
            }
        }).then(d=>{
            document.querySelector("#start-route-tag").style.display = "flex"
            if (d.status =="ok"){
                let r = document.querySelector("#start-route-tag-tag");
                r.textContent = "Start"
                r.setAttribute("onclick", 'return SetRouter(true)')
                document.querySelector("#start-route-tag").setAttribute("onclick", 'return SetRouter(true)')
            }
        })   

    }
}

setInterval(CheckRoute_state, 4000)

</script>
{{/*<script src="http://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit"></script>*/}}

