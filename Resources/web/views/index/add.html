<div class="row tile">
    <div class="col-md-12 col-md-auto">
        <div class="ibox float-e-margins">
            <h3 class="ibox-title" langtag="page-add"></h3>
            <div class="ibox-content">
                <form class="form-horizontal">
                    <div class="form-group">
                        <label class="control-label font-bold" langtag="word-scheme">服务类型</label>
                        <div class="col-sm-10">
                            <span class="help-block m-b-none font-bold" langtag="word-usecase"></span>:
                            <span id="usecase">
                                <span id="caseclient" langtag="info-case client"></span>
                                <span id="caseserver" langtag="info-case server"></span>
                                <span id="casereverse-server" langtag="info-case reverse server"></span>
                                <span id="casereverse-client" langtag="info-case reverse client"></span>
                                
                            </span>
                            <select class="form-control" name="type" id="type" >
                                <option value="server" langtag="scheme-server" selected >正向代理监听器</option>
                                <option value="client" langtag="scheme-client">开启正向代理客户端</option>                                
                                <option value="reverse-server" langtag="scheme-reverse server">开启反向代理监听器</option>
                                <option value="reverse-client" langtag="scheme-reverse client">开启反向代理的客户端</option>
                                <option value="map-port" langtag="scheme-map port">映射端口到远端</option>
                                {{/*<option value="file" langtag="scheme-file"></option>*/}}
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="protocol">
                        <span class="control-label font-bold"  langtag="info-protocol">网络协议</span>
                        <div class="col-sm-10">
                            <select class="form-control" name="protocol" >
                                <option value="tls" langtag="scheme-tls" selected  ></option>
                                <option value="kcp" langtag="scheme-kcp"></option>
                                <option value="wss" langtag="scheme-wss"></option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group"  id="io-multi">
                        <span  class="control-label font-bold" langtag="info-ioMulti">是否开启io复用mux</span>
                        <div class="col-sm-10">
                            <select class="form-control" name="io-multi" >
                                <option value="yes" langtag="scheme-yes"  ></option>
                                <option value="no" langtag="scheme-no" selected></option>
                            </select>
                        </div>
                    </div>


                    

                    
                    {{if eq true .allow_multi_ip}}
                        <div class="form-group" id="server_ip">
                            <label class="control-label font-bold" langtag="word-serverip">服务器IP</label>
                            <div class="col-sm-10">
                                {{ if eq "" .ip  }}
                                <input class="form-control" type="text" value="0.0.0.0" name="server_ip" placeholder=""
                                       langtag="info-suchasip">
                                {{ else }}
                                <input class="form-control" type="text" value="{{.ip}}" name="server_ip" placeholder=""
                                       langtag="info-suchasip">
                                {{ end }}
                            </div>
                        </div>
                    {{end}}
                    <div class="form-group" id="port">
                        <label class="control-label font-bold" langtag="word-serverport">服务器端口</label>
                        <div class="col-sm-10">
                            {{ if eq .port "" }}
                            <input class="form-control" type="text" name="port" placeholder=""
                                   langtag="info-suchasport">
                            {{else }}
                            <input class="form-control" type="text" name="port" value="{{.port}}" placeholder=""
                                   langtag="info-suchasport">
                            {{end}}
                        </div>
                    </div>

                    {{if eq true .allow_local_proxy}}
                        <div class="form-group" id="local_proxy">
                            <label class="control-label font-bold" langtag="word-proxytolocal"></label>
                            <div class="col-sm-10">
                                <select class="form-control" name="local_proxy">
                                    <option value="0" langtag="word-no"></option>
                                    <option value="1" langtag="word-yes"></option>
                                </select>
                            </div>
                        </div>
                    {{end}}

                    <div class="form-group" id="target">
                        <label class="control-label font-bold" langtag="word-target"></label>
                        <div class="col-sm-10">
                            <textarea class="form-control" name="target" rows="4" placeholder=""
                                      langtag="info-suchasiplist"></textarea>
                            <span class="help-block m-b-none" langtag="info-targettunnel"></span>
                        </div>
                    </div>
                    <div class="form-group"  id="local_protocol">
                        <span  class="control-label font-bold" langtag="info-local protocol"></span>
                        <div class="col-sm-10">
                            <select class="form-control" name="local_protocol" >
                                <option value="socks5" langtag="scheme-socks5" selected ></option>
                                <option value="http" langtag="scheme-http" ></option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group" id="local_ip">
                        <label class="control-label font-bold" langtag="word-local ip">本地监听IP</label>
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="local_ip" value="localhost" placeholder=""
                                   langtag="info-suchaslocalpath">
                        </div>
                    </div>
                    <div class="form-group" id="local_port">
                        <label class="control-label font-bold" langtag="word-local port">本地监听端口</label>
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="local_port" placeholder=""
                                   langtag="info-suchaslocalpath">
                        </div>
                    </div>
                    <div class="form-group" id="strip_pre">
                        <label class="control-label font-bold" langtag="word-stripprefix"></label>
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="strip_pre" placeholder=""
                                   langtag="info-suchasstripprefix">
                        </div>
                    </div>

                    <div class="form-group" id="password">
                        <label class="control-label font-bold" langtag="word-identificationkey"></label>
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="password" placeholder=""
                                   langtag="word-identificationkey">
                            <span class="help-block m-b-none" langtag="info-identificationkey"></span>
                        </div>
                    </div>
                    <!-- <div class="form-group">
                        <label class="control-label font-bold" langtag="word-remark"></label>
                        <div class="col-sm-10">
                            <input class="form-control" type="text" name="remark" placeholder=""
                                   langtag="info-unrestricted">
                        </div>
                    </div> -->
                    <div class="hr-line-dashed"></div>
                    <div class="form-group">
                        <div class="col-sm-4 col-sm-offset-2">
                            <button class="btn btn-success" type="button"
                                    onclick="submitform('add', '{{.web_base_url}}/index/add', $('form').serializeArray())">
                                <i class="fa fa-fw fa-lg fa-check-circle"></i> <span langtag="word-add"></span>
                            </button>
                        </div>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>
<script>
    var arr = []
    arr["client"] = ["port" , "protocol", "server_ip","io-multi","local_ip","local_port"]
    arr["server"] = ["port",  "server_ip", "protocol", "io-multi","client_id"]
    arr["reverse-server"] = ["port", "client_id","protocol",  "server_ip"]
    arr["reverse-client"] = ["port", "client_id", "server_ip", "password", "local_ip","local_port"]
    arr["map-port"] = ["port", "client_id", "server_ip", "local_ip","local_port"]
    
    // arr["secret"] = ["target", "password", "client_id", "server_ip"]
    // arr["p2p"] = ["target", "password", "client_id", "server_ip"]
    // arr["file"] = ["port", "local_path", "strip_pre", "client_id", "server_ip"]

    function resetForm() {
        $(".form-group[id]").css("display", "none");
        $("#usecase span").css("display", "none");
        o = $("#type").val();
        if (o == null){
            o = "client"
        }
        $("#protocol").val(('{{.protocol}}' == '') ? 'tls' : '{{.protocol}}');

        $('#case' + o).css("display", "inline")
        console.log("oo:",o)
        for (var i = 0; i < arr[o].length; i++) {
            console.log("open:",arr[o][i]);
            $("#" + arr[o][i]).css("display", "block")
            if (arr[o][i] =="port" ){
                let old_port = $("[name=\""+arr[o][i]+"\"]" ).val();
                if (old_port == ""){
                    let P = 10000 + Math.round(Math.random() * 40000);
                    $("[name=\""+arr[o][i]+"\"]" ).val(P);
                }
            }
            if (arr[o][i] =="local_port" ){
                let P = 1080 + Math.round(Math.random() * 100);
                $("[name=\""+arr[o][i]+"\"]" ).val(P);
            }
        }
   
    }

    $(function () {
        $("#type").val(('{{.type}}' == '') ? 'server' : '{{.type}}');
        resetForm()
        $("#type").on("change", function () {
            console.log("Change it :",)
            resetForm()
        })
        $("#use_client").on("change", function () {
            resetForm()
        })
    })
</script>
